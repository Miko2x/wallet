{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/objectSpread","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = getChildEventSubscriber;\n\n  var _objectSpread2 = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/helpers/objectSpread\"));\n\n  function getChildEventSubscriber(addListener, key) {\n    var actionSubscribers = new Set();\n    var willFocusSubscribers = new Set();\n    var didFocusSubscribers = new Set();\n    var willBlurSubscribers = new Set();\n    var didBlurSubscribers = new Set();\n\n    var removeAll = function removeAll() {\n      [actionSubscribers, willFocusSubscribers, didFocusSubscribers, willBlurSubscribers, didBlurSubscribers].forEach(function (set) {\n        return set.clear();\n      });\n      upstreamSubscribers.forEach(function (subs) {\n        return subs && subs.remove();\n      });\n    };\n\n    var getChildSubscribers = function getChildSubscribers(evtName) {\n      switch (evtName) {\n        case 'action':\n          return actionSubscribers;\n\n        case 'willFocus':\n          return willFocusSubscribers;\n\n        case 'didFocus':\n          return didFocusSubscribers;\n\n        case 'willBlur':\n          return willBlurSubscribers;\n\n        case 'didBlur':\n          return didBlurSubscribers;\n\n        default:\n          return null;\n      }\n    };\n\n    var emit = function emit(type, payload) {\n      var payloadWithType = (0, _objectSpread2.default)({}, payload, {\n        type: type\n      });\n      var subscribers = getChildSubscribers(type);\n      subscribers && subscribers.forEach(function (subs) {\n        subs(payloadWithType);\n      });\n    };\n\n    var lastEmittedEvent = 'didBlur';\n    var upstreamEvents = ['willFocus', 'didFocus', 'willBlur', 'didBlur', 'action'];\n    var upstreamSubscribers = upstreamEvents.map(function (eventName) {\n      return addListener(eventName, function (payload) {\n        var state = payload.state,\n            lastState = payload.lastState,\n            action = payload.action;\n        var lastRoutes = lastState && lastState.routes;\n        var routes = state && state.routes;\n        var lastFocusKey = lastState && lastState.routes && lastState.routes[lastState.index].key;\n        var focusKey = routes && routes[state.index].key;\n        var isChildFocused = focusKey === key;\n        var lastRoute = lastRoutes && lastRoutes.find(function (route) {\n          return route.key === key;\n        });\n        var newRoute = routes && routes.find(function (route) {\n          return route.key === key;\n        });\n        var childPayload = {\n          context: key + \":\" + action.type + \"_\" + (payload.context || 'Root'),\n          state: newRoute,\n          lastState: lastRoute,\n          action: action,\n          type: eventName\n        };\n        var isTransitioning = !!state && state.isTransitioning;\n        var previouslyLastEmittedEvent = lastEmittedEvent;\n\n        if (lastEmittedEvent === 'didBlur') {\n          if (eventName === 'willFocus' && isChildFocused) {\n            emit(lastEmittedEvent = 'willFocus', childPayload);\n          } else if (eventName === 'action' && isChildFocused) {\n            emit(lastEmittedEvent = 'willFocus', childPayload);\n          }\n        }\n\n        if (lastEmittedEvent === 'willFocus') {\n          if (eventName === 'didFocus' && isChildFocused && !isTransitioning) {\n            emit(lastEmittedEvent = 'didFocus', childPayload);\n          } else if (eventName === 'action' && isChildFocused && !isTransitioning) {\n            emit(lastEmittedEvent = 'didFocus', childPayload);\n          }\n        }\n\n        if (lastEmittedEvent === 'didFocus') {\n          if (!isChildFocused) {\n            emit(lastEmittedEvent = 'willBlur', childPayload);\n          } else if (eventName === 'willBlur') {\n            emit(lastEmittedEvent = 'willBlur', childPayload);\n          } else if (eventName === 'action' && previouslyLastEmittedEvent === 'didFocus') {\n            emit('action', childPayload);\n          }\n        }\n\n        if (lastEmittedEvent === 'willBlur') {\n          if (eventName === 'action' && !isChildFocused && !isTransitioning) {\n            emit(lastEmittedEvent = 'didBlur', childPayload);\n          } else if (eventName === 'didBlur') {\n            emit(lastEmittedEvent = 'didBlur', childPayload);\n          }\n        }\n\n        if (lastEmittedEvent === 'didBlur' && !newRoute) {\n          removeAll();\n        }\n      });\n    });\n    return {\n      addListener: function addListener(eventName, eventHandler) {\n        var subscribers = getChildSubscribers(eventName);\n\n        if (!subscribers) {\n          throw new Error(\"Invalid event name \\\"\" + eventName + \"\\\"\");\n        }\n\n        subscribers.add(eventHandler);\n\n        var remove = function remove() {\n          subscribers.delete(eventHandler);\n        };\n\n        return {\n          remove: remove\n        };\n      }\n    };\n  }\n});","map":[[11,0,7,15],[11,11,7,24,"getChildEventSubscriber"],[11,34,7,15],[11,35,7,48,"addListener"],[11,46,7,15],[11,48,7,61,"key"],[11,51,7,15],[11,53,7,66],[12,0,8,2],[12,8,8,8,"actionSubscribers"],[12,25,8,25],[12,28,8,28],[12,32,8,32,"Set"],[12,35,8,28],[12,37,8,2],[13,0,9,2],[13,8,9,8,"willFocusSubscribers"],[13,28,9,28],[13,31,9,31],[13,35,9,35,"Set"],[13,38,9,31],[13,40,9,2],[14,0,10,2],[14,8,10,8,"didFocusSubscribers"],[14,27,10,27],[14,30,10,30],[14,34,10,34,"Set"],[14,37,10,30],[14,39,10,2],[15,0,11,2],[15,8,11,8,"willBlurSubscribers"],[15,27,11,27],[15,30,11,30],[15,34,11,34,"Set"],[15,37,11,30],[15,39,11,2],[16,0,12,2],[16,8,12,8,"didBlurSubscribers"],[16,26,12,26],[16,29,12,29],[16,33,12,33,"Set"],[16,36,12,29],[16,38,12,2],[18,0,14,2],[18,8,14,8,"removeAll"],[18,17,14,17],[18,20,14,20],[18,29,14,8,"removeAll"],[18,38,14,20],[18,41,14,26],[19,0,15,4],[19,7,16,6,"actionSubscribers"],[19,24,15,4],[19,26,17,6,"willFocusSubscribers"],[19,46,15,4],[19,48,18,6,"didFocusSubscribers"],[19,67,15,4],[19,69,19,6,"willBlurSubscribers"],[19,88,15,4],[19,90,20,6,"didBlurSubscribers"],[19,108,15,4],[19,110,21,6,"forEach"],[19,117,15,4],[19,118,21,14],[19,128,21,14,"set"],[19,131,21,17],[20,0,21,17],[20,15,21,21,"set"],[20,18,21,24],[20,19,21,25,"clear"],[20,24,21,21],[20,26,21,17],[21,0,21,17],[21,7,15,4],[22,0,23,4,"upstreamSubscribers"],[22,6,23,4,"upstreamSubscribers"],[22,25,23,23],[22,26,23,24,"forEach"],[22,33,23,4],[22,34,23,32],[22,44,23,32,"subs"],[22,48,23,36],[23,0,23,36],[23,15,23,40,"subs"],[23,19,23,44],[23,23,23,48,"subs"],[23,27,23,52],[23,28,23,53,"remove"],[23,34,23,48],[23,36,23,36],[24,0,23,36],[24,7,23,4],[25,0,24,3],[25,5,14,2],[27,0,26,2],[27,8,26,8,"getChildSubscribers"],[27,27,26,27],[27,30,26,30],[27,39,26,8,"getChildSubscribers"],[27,58,26,30],[27,59,26,30,"evtName"],[27,66,26,37],[27,68,26,41],[28,0,27,4],[28,14,27,12,"evtName"],[28,21,27,4],[29,0,28,6],[29,13,28,11],[29,21,28,6],[30,0,29,8],[30,17,29,15,"actionSubscribers"],[30,34,29,8],[32,0,30,6],[32,13,30,11],[32,24,30,6],[33,0,31,8],[33,17,31,15,"willFocusSubscribers"],[33,37,31,8],[35,0,32,6],[35,13,32,11],[35,23,32,6],[36,0,33,8],[36,17,33,15,"didFocusSubscribers"],[36,36,33,8],[38,0,34,6],[38,13,34,11],[38,23,34,6],[39,0,35,8],[39,17,35,15,"willBlurSubscribers"],[39,36,35,8],[41,0,36,6],[41,13,36,11],[41,22,36,6],[42,0,37,8],[42,17,37,15,"didBlurSubscribers"],[42,35,37,8],[44,0,38,6],[45,0,39,8],[45,17,39,15],[45,21,39,8],[46,0,27,4],[47,0,41,3],[47,5,26,2],[49,0,43,2],[49,8,43,8,"emit"],[49,12,43,12],[49,15,43,15],[49,24,43,8,"emit"],[49,28,43,15],[49,29,43,16,"type"],[49,33,43,15],[49,35,43,22,"payload"],[49,42,43,15],[49,44,43,34],[50,0,44,4],[50,10,44,10,"payloadWithType"],[50,25,44,25],[50,60,44,33,"payload"],[50,67,44,25],[51,0,44,42,"type"],[51,8,44,42,"type"],[51,12,44,46],[51,14,44,42,"type"],[52,0,44,25],[52,8,44,4],[53,0,45,4],[53,10,45,10,"subscribers"],[53,21,45,21],[53,24,45,24,"getChildSubscribers"],[53,43,45,43],[53,44,45,44,"type"],[53,48,45,43],[53,49,45,4],[54,0,46,4,"subscribers"],[54,6,46,4,"subscribers"],[54,17,46,15],[54,21,47,6,"subscribers"],[54,32,47,17],[54,33,47,18,"forEach"],[54,40,47,6],[54,41,47,26],[54,51,47,26,"subs"],[54,55,47,30],[54,57,47,34],[55,0,48,8,"subs"],[55,8,48,8,"subs"],[55,12,48,12],[55,13,48,13,"payloadWithType"],[55,28,48,12],[55,29,48,8],[56,0,49,7],[56,7,47,6],[56,8,46,4],[57,0,50,3],[57,5,43,2],[59,0,56,2],[59,8,56,6,"lastEmittedEvent"],[59,24,56,22],[59,27,56,25],[59,36,56,2],[60,0,58,2],[60,8,58,8,"upstreamEvents"],[60,22,58,22],[60,25,58,25],[60,26,59,4],[60,37,58,25],[60,39,60,4],[60,49,58,25],[60,51,61,4],[60,61,58,25],[60,63,62,4],[60,72,58,25],[60,74,63,4],[60,82,58,25],[60,83,58,2],[61,0,66,2],[61,8,66,8,"upstreamSubscribers"],[61,27,66,27],[61,30,66,30,"upstreamEvents"],[61,44,66,44],[61,45,66,45,"map"],[61,48,66,30],[61,49,66,49],[61,59,66,49,"eventName"],[61,68,66,58],[62,0,66,58],[62,13,67,4,"addListener"],[62,24,67,15],[62,25,67,16,"eventName"],[62,34,67,15],[62,36,67,27],[62,46,67,27,"payload"],[62,53,67,34],[62,55,67,38],[63,0,67,38],[63,12,68,14,"state"],[63,17,67,38],[63,20,68,43,"payload"],[63,27,67,38],[63,28,68,14,"state"],[63,33,67,38],[64,0,67,38],[64,12,68,21,"lastState"],[64,21,67,38],[64,24,68,43,"payload"],[64,31,67,38],[64,32,68,21,"lastState"],[64,41,67,38],[65,0,67,38],[65,12,68,32,"action"],[65,18,67,38],[65,21,68,43,"payload"],[65,28,67,38],[65,29,68,32,"action"],[65,35,67,38],[66,0,69,6],[66,12,69,12,"lastRoutes"],[66,22,69,22],[66,25,69,25,"lastState"],[66,34,69,34],[66,38,69,38,"lastState"],[66,47,69,47],[66,48,69,48,"routes"],[66,54,69,6],[67,0,70,6],[67,12,70,12,"routes"],[67,18,70,18],[67,21,70,21,"state"],[67,26,70,26],[67,30,70,30,"state"],[67,35,70,35],[67,36,70,36,"routes"],[67,42,70,6],[68,0,72,6],[68,12,72,12,"lastFocusKey"],[68,24,72,24],[68,27,73,8,"lastState"],[68,36,73,17],[68,40,73,21,"lastState"],[68,49,73,30],[68,50,73,31,"routes"],[68,56,73,8],[68,60,73,41,"lastState"],[68,69,73,50],[68,70,73,51,"routes"],[68,76,73,41],[68,77,73,58,"lastState"],[68,86,73,67],[68,87,73,68,"index"],[68,92,73,41],[68,94,73,75,"key"],[68,97,72,6],[69,0,74,6],[69,12,74,12,"focusKey"],[69,20,74,20],[69,23,74,23,"routes"],[69,29,74,29],[69,33,74,33,"routes"],[69,39,74,39],[69,40,74,40,"state"],[69,45,74,45],[69,46,74,46,"index"],[69,51,74,39],[69,52,74,33],[69,53,74,53,"key"],[69,56,74,6],[70,0,76,6],[70,12,76,12,"isChildFocused"],[70,26,76,26],[70,29,76,29,"focusKey"],[70,37,76,37],[70,42,76,42,"key"],[70,45,76,6],[71,0,77,6],[71,12,77,12,"lastRoute"],[71,21,77,21],[71,24,78,8,"lastRoutes"],[71,34,78,18],[71,38,78,22,"lastRoutes"],[71,48,78,32],[71,49,78,33,"find"],[71,53,78,22],[71,54,78,38],[71,64,78,38,"route"],[71,69,78,43],[72,0,78,43],[72,17,78,47,"route"],[72,22,78,52],[72,23,78,53,"key"],[72,26,78,47],[72,31,78,61,"key"],[72,34,78,43],[73,0,78,43],[73,9,78,22],[73,10,77,6],[74,0,79,6],[74,12,79,12,"newRoute"],[74,20,79,20],[74,23,79,23,"routes"],[74,29,79,29],[74,33,79,33,"routes"],[74,39,79,39],[74,40,79,40,"find"],[74,44,79,33],[74,45,79,45],[74,55,79,45,"route"],[74,60,79,50],[75,0,79,50],[75,17,79,54,"route"],[75,22,79,59],[75,23,79,60,"key"],[75,26,79,54],[75,31,79,68,"key"],[75,34,79,50],[76,0,79,50],[76,9,79,33],[76,10,79,6],[77,0,80,6],[77,12,80,12,"childPayload"],[77,24,80,24],[77,27,80,27],[78,0,81,8,"context"],[78,10,81,8,"context"],[78,17,81,15],[78,19,81,20,"key"],[78,22,81,15],[78,31,81,27,"action"],[78,37,81,33],[78,38,81,34,"type"],[78,42,81,15],[78,52,81,42,"payload"],[78,59,81,49],[78,60,81,50,"context"],[78,67,81,42],[78,71,81,61],[78,77,81,15],[78,78,80,27],[79,0,82,8,"state"],[79,10,82,8,"state"],[79,15,82,13],[79,17,82,15,"newRoute"],[79,25,80,27],[80,0,83,8,"lastState"],[80,10,83,8,"lastState"],[80,19,83,17],[80,21,83,19,"lastRoute"],[80,30,80,27],[81,0,84,8,"action"],[81,10,84,8,"action"],[81,16,84,14],[81,18,84,8,"action"],[81,24,80,27],[82,0,85,8,"type"],[82,10,85,8,"type"],[82,14,85,12],[82,16,85,14,"eventName"],[83,0,80,27],[83,9,80,6],[84,0,87,6],[84,12,87,12,"isTransitioning"],[84,27,87,27],[84,30,87,30],[84,31,87,31],[84,32,87,32,"state"],[84,37,87,30],[84,41,87,41,"state"],[84,46,87,46],[84,47,87,47,"isTransitioning"],[84,62,87,6],[85,0,89,6],[85,12,89,12,"previouslyLastEmittedEvent"],[85,38,89,38],[85,41,89,41,"lastEmittedEvent"],[85,57,89,6],[87,0,91,6],[87,12,91,10,"lastEmittedEvent"],[87,28,91,26],[87,33,91,31],[87,42,91,6],[87,44,91,42],[88,0,93,8],[88,14,93,12,"eventName"],[88,23,93,21],[88,28,93,26],[88,39,93,12],[88,43,93,41,"isChildFocused"],[88,57,93,8],[88,59,93,57],[89,0,94,10,"emit"],[89,12,94,10,"emit"],[89,16,94,14],[89,17,94,16,"lastEmittedEvent"],[89,33,94,32],[89,36,94,35],[89,47,94,14],[89,49,94,49,"childPayload"],[89,61,94,14],[89,62,94,10],[90,0,95,9],[90,11,93,8],[90,17,95,15],[90,21,95,19,"eventName"],[90,30,95,28],[90,35,95,33],[90,43,95,19],[90,47,95,45,"isChildFocused"],[90,61,95,15],[90,63,95,61],[91,0,96,10,"emit"],[91,12,96,10,"emit"],[91,16,96,14],[91,17,96,16,"lastEmittedEvent"],[91,33,96,32],[91,36,96,35],[91,47,96,14],[91,49,96,49,"childPayload"],[91,61,96,14],[91,62,96,10],[92,0,97,9],[93,0,98,7],[95,0,99,6],[95,12,99,10,"lastEmittedEvent"],[95,28,99,26],[95,33,99,31],[95,44,99,6],[95,46,99,44],[96,0,102,8],[96,14,102,12,"eventName"],[96,23,102,21],[96,28,102,26],[96,38,102,12],[96,42,102,40,"isChildFocused"],[96,56,102,12],[96,60,102,58],[96,61,102,59,"isTransitioning"],[96,76,102,8],[96,78,102,76],[97,0,103,10,"emit"],[97,12,103,10,"emit"],[97,16,103,14],[97,17,103,16,"lastEmittedEvent"],[97,33,103,32],[97,36,103,35],[97,46,103,14],[97,48,103,48,"childPayload"],[97,60,103,14],[97,61,103,10],[98,0,104,9],[98,11,102,8],[98,17,104,15],[98,21,105,10,"eventName"],[98,30,105,19],[98,35,105,24],[98,43,105,10],[98,47,106,10,"isChildFocused"],[98,61,105,10],[98,65,107,10],[98,66,107,11,"isTransitioning"],[98,81,104,15],[98,83,108,10],[99,0,109,10,"emit"],[99,12,109,10,"emit"],[99,16,109,14],[99,17,109,16,"lastEmittedEvent"],[99,33,109,32],[99,36,109,35],[99,46,109,14],[99,48,109,48,"childPayload"],[99,60,109,14],[99,61,109,10],[100,0,110,9],[101,0,111,7],[103,0,113,6],[103,12,113,10,"lastEmittedEvent"],[103,28,113,26],[103,33,113,31],[103,43,113,6],[103,45,113,43],[104,0,115,8],[104,14,115,12],[104,15,115,13,"isChildFocused"],[104,29,115,8],[104,31,115,29],[105,0,117,10,"emit"],[105,12,117,10,"emit"],[105,16,117,14],[105,17,117,16,"lastEmittedEvent"],[105,33,117,32],[105,36,117,35],[105,46,117,14],[105,48,117,48,"childPayload"],[105,60,117,14],[105,61,117,10],[106,0,118,9],[106,11,115,8],[106,17,118,15],[106,21,118,19,"eventName"],[106,30,118,28],[106,35,118,33],[106,45,118,15],[106,47,118,45],[107,0,120,10,"emit"],[107,12,120,10,"emit"],[107,16,120,14],[107,17,120,16,"lastEmittedEvent"],[107,33,120,32],[107,36,120,35],[107,46,120,14],[107,48,120,48,"childPayload"],[107,60,120,14],[107,61,120,10],[108,0,121,9],[108,11,118,15],[108,17,121,15],[108,21,122,10,"eventName"],[108,30,122,19],[108,35,122,24],[108,43,122,10],[108,47,123,10,"previouslyLastEmittedEvent"],[108,73,123,36],[108,78,123,41],[108,88,121,15],[108,90,124,10],[109,0,126,10,"emit"],[109,12,126,10,"emit"],[109,16,126,14],[109,17,126,15],[109,25,126,14],[109,27,126,25,"childPayload"],[109,39,126,14],[109,40,126,10],[110,0,127,9],[111,0,128,7],[113,0,130,6],[113,12,130,10,"lastEmittedEvent"],[113,28,130,26],[113,33,130,31],[113,43,130,6],[113,45,130,43],[114,0,132,8],[114,14,132,12,"eventName"],[114,23,132,21],[114,28,132,26],[114,36,132,12],[114,40,132,38],[114,41,132,39,"isChildFocused"],[114,55,132,12],[114,59,132,57],[114,60,132,58,"isTransitioning"],[114,75,132,8],[114,77,132,75],[115,0,135,10,"emit"],[115,12,135,10,"emit"],[115,16,135,14],[115,17,135,16,"lastEmittedEvent"],[115,33,135,32],[115,36,135,35],[115,45,135,14],[115,47,135,47,"childPayload"],[115,59,135,14],[115,60,135,10],[116,0,136,9],[116,11,132,8],[116,17,136,15],[116,21,136,19,"eventName"],[116,30,136,28],[116,35,136,33],[116,44,136,15],[116,46,136,44],[117,0,138,10,"emit"],[117,12,138,10,"emit"],[117,16,138,14],[117,17,138,16,"lastEmittedEvent"],[117,33,138,32],[117,36,138,35],[117,45,138,14],[117,47,138,47,"childPayload"],[117,59,138,14],[117,60,138,10],[118,0,139,9],[119,0,140,7],[121,0,142,6],[121,12,142,10,"lastEmittedEvent"],[121,28,142,26],[121,33,142,31],[121,42,142,10],[121,46,142,44],[121,47,142,45,"newRoute"],[121,55,142,6],[121,57,142,55],[122,0,143,8,"removeAll"],[122,10,143,8,"removeAll"],[122,19,143,17],[123,0,144,7],[124,0,145,5],[124,7,67,15],[124,8,66,58],[125,0,66,58],[125,5,66,30],[125,6,66,2],[126,0,148,2],[126,11,148,9],[127,0,149,4,"addListener"],[127,6,149,4,"addListener"],[127,17,148,9],[127,40,149,16,"eventName"],[127,49,148,9],[127,51,149,27,"eventHandler"],[127,63,148,9],[127,65,149,41],[128,0,150,6],[128,12,150,12,"subscribers"],[128,23,150,23],[128,26,150,26,"getChildSubscribers"],[128,45,150,45],[128,46,150,46,"eventName"],[128,55,150,45],[128,56,150,6],[130,0,151,6],[130,12,151,10],[130,13,151,11,"subscribers"],[130,24,151,6],[130,26,151,24],[131,0,152,8],[131,16,152,14],[131,20,152,18,"Error"],[131,25,152,14],[131,52,152,47,"eventName"],[131,61,152,14],[131,69,152,8],[132,0,153,7],[134,0,154,6,"subscribers"],[134,8,154,6,"subscribers"],[134,19,154,17],[134,20,154,18,"add"],[134,23,154,6],[134,24,154,22,"eventHandler"],[134,36,154,6],[136,0,155,6],[136,12,155,12,"remove"],[136,18,155,18],[136,21,155,21],[136,30,155,12,"remove"],[136,36,155,21],[136,39,155,27],[137,0,156,8,"subscribers"],[137,10,156,8,"subscribers"],[137,21,156,19],[137,22,156,20,"delete"],[137,28,156,8],[137,29,156,27,"eventHandler"],[137,41,156,8],[138,0,157,7],[138,9,155,6],[140,0,158,6],[140,15,158,13],[141,0,158,15,"remove"],[141,10,158,15,"remove"],[141,16,158,21],[141,18,158,15,"remove"],[142,0,158,13],[142,9,158,6],[143,0,159,5],[144,0,148,9],[144,5,148,2],[145,0,161,1]]},"type":"js/module"}]}